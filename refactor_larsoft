#!/bin/bash
TOP=${1:-junk}
echo "Fixing files in directory $TOP"
find $TOP \( -type d \( -name SoftRelTools -o -name man -o -name bin -o -name tmp -o -name job -o -name .git -o \
    -name .svn -o -name CVS -o -name ups \) -prune \) -o -type f \! \( -name '*_dict.cc' -o -name '*_map.cc' -o -name '*~' \
    -o -name '*.bak' -o -name '*.orig' -o -name '*.new' -o -name '*.gdml' -o -name '*.py' -o -name '*.sh' -o -name '*.o' \
    -o -name '*.so' -o -name '*.os' -o -name '*.root' -o -name 'SConscript' -o -name '*.pdf' -o -name '*.html' \) -print0 \
    | while IFS= read -rd $'\0' F ;do \
    perl -wapi\~ -f fix-header-locs-larsoft.pl "${F}" >/dev/null 2>&1 && rm -f "${F}~" ;done
for file in `find $TOP -name CMakeLists.txt`;do perl -wapi\~ -f fix_cmake_larsoft.pl "$file" && rm "${file}~";done
for file in `find $TOP -name CMakeLists.txt`;do grep -w BASENAME_ONLY $file && sed -i~ -e's/BASENAME_ONLY//g' "$file" && rm "${file}~";done
